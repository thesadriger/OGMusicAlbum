[?2004h[?1049h[22;0;0t[1;41r(B[m[4l[?7h[39;49m[?1h=[?1h=[?25l[39;49m(B[m[H[2J[39;84H(B[0;7m[ Reading... ](B[m[39;82H(B[0;7m[ Read 162 lines ](B[m[H(B[0;7m  GNU nano 7.2                                                                           main.py                                                                                     [1;180H(B[m[40d(B[0;7m^G(B[m Help[40;17H(B[0;7m^O(B[m Write Out    (B[0;7m^W(B[m Where Is     (B[0;7m^K(B[m Cut[40;65H(B[0;7m^T(B[m Execute[81G(B[0;7m^C(B[m Location     (B[0;7mM-U(B[m Undo[40;113H(B[0;7mM-A(B[m Set Mark    (B[0;7mM-](B[m To Bracket  (B[0;7mM-Q(B[m Previous    (B[0;7m^B(B[m Back[41d(B[0;7m^X(B[m Exit[41;17H(B[0;7m^R(B[m Read File    (B[0;7m^\(B[m Replace[49G(B[0;7m^U(B[m Paste[41;65H(B[0;7m^J(B[m Justify[81G(B[0;7m^/(B[m Go To Line   (B[0;7mM-E(B[m Redo[41;113H(B[0;7mM-6(B[m Copy[41;129H(B[0;7m^Q(B[m Where Was    (B[0;7mM-W(B[m Next[41;161H(B[0;7m^F(B[m Forward[2d(B[0;1m[31m#!/usr/bin/env python3[3d[36mimport[39m(B[m os, json[4d(B[0;1m[36mfrom[39m(B[m typing (B[0;1m[36mimport[39m(B[m List, Optional, Any, Dict[5d(B[0;1m[36mfrom[39m(B[m fastapi (B[0;1m[36mimport[39m(B[m FastAPI, Query, HTTPException[6d(B[0;1m[36mfrom[39m(B[m fastapi.middleware.cors (B[0;1m[36mimport[39m(B[m CORSMiddleware[7d(B[0;1m[36mimport[39m(B[m asyncpg, httpx[8d(B[0;1m[36mfrom[39m(B[m pydantic (B[0;1m[36mimport[39m(B[m BaseModel[9d(B[0;1m[36mfrom[39m(B[m dotenv (B[0;1m[36mimport[39m(B[m load_dotenv[11dload_dotenv()[13dPG_DSN     = os.environ[(B[0;1m[32m"PG_DSN"[39m(B[m][14dMEILI_HOST = os.environ[(B[0;1m[32m"MEILI_HOST"[39m(B[m].rstrip((B[0;1m[32m"/"[39m(B[m)[15dMEILI_KEY  = os.environ[(B[0;1m[32m"MEILI_KEY"[39m(B[m][17dapp = FastAPI(title=(B[0;1m[32m"OGMA Search API"[39m(B[m, version=(B[0;1m[32m"1.0"[39m(B[m)[19d(B[0;1m[31m# Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒ Ð´Ð¾Ð¼ÐµÐ½Ñ‹ Ñ„Ñ€Ð¾Ð½Ñ‚Ð°[20d[39m(B[mapp.add_middleware([21;5HCORSMiddleware,[22;5Hallow_origins=[(B[0;1m[32m"*"[39m(B[m], allow_credentials=(B[0;1m[35mFalse[39m(B[m,[23;5Hallow_methods=[(B[0;1m[32m"GET"[39m(B[m, (B[0;1m[32m"POST"[39m(B[m, (B[0;1m[32m"OPTIONS"[39m(B[m],[24;5Hallow_headers=[(B[0;1m[32m"*"[39m(B[m],[25d)[27d(B[0;1m[31m# ---------- DB ----------[28d[39m(B[mpool: asyncpg.Pool = (B[0;1m[35mNone[30d[39m(B[m@app.on_event((B[0;1m[32m"startup"[39m(B[m)[31d(B[0;1m[36masync[39m(B[m (B[0;1m[36mdef[34m on_startup[39m(B[m():[32;5H(B[0;1m[36mglobal[39m(B[m pool[33;5Hpool = (B[0;1m[36mawait[39m(B[m asyncpg.create_pool(PG_DSN, min_size=1, max_size=6)[35d@app.on_event((B[0;1m[32m"shutdown"[39m(B[m)[36d(B[0;1m[36masync[39m(B[m (B[0;1m[36mdef[34m on_shutdown[39m(B[m():[37;5H(B[0;1m[36mif[39m(B[m pool:[38;9H(B[0;1m[36mawait[39m(B[m pool.close()[2d[?12l[?25h[?25l[1;98H(B[0;7m*[180G(B[m7[2;38r8[2dM[1;41r[3;1H[?12l[?25h[?25l[39;60H(B[0;7m[ line   2/164 ( 1%), col  1/23 (  4%), char    1/5194 ( 0%) ](B[m[?12l[?25h[3d[?25l[?12l[?25h[41;1H[?1049l[23;0;0t[?1l>[?2004l